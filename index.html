<html class="scroll-smooth" lang="id">
 <head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1" name="viewport"/>
  <title>
   Berita Terkini - NewsApp
  </title>
  <script src="https://cdn.tailwindcss.com">
  </script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&amp;display=swap" rel="stylesheet"/>
  <style>
   html {
      scroll-behavior: smooth;
    }
    body {
      font-family: 'Inter', sans-serif;
    }
    /* Custom scrollbar for dark mode */
    .dark ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }
    .dark ::-webkit-scrollbar-track {
      background: #1f2937;
    }
    .dark ::-webkit-scrollbar-thumb {
      background-color: #4b5563;
      border-radius: 10px;
      border: 2px solid #1f2937;
    }
  </style>
 </head>
 <body class="bg-white text-gray-900 dark:bg-gray-900 dark:text-gray-100 transition-colors duration-300">
  <header class="sticky top-0 z-50 bg-white dark:bg-gray-800 shadow-md">
   <nav class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 flex items-center justify-between h-16">
    <div class="flex items-center space-x-3">
     <img alt="Logo NewsApp, huruf N berwarna putih di latar biru" class="w-10 h-10 rounded-md" height="40" loading="lazy" src="https://storage.googleapis.com/a1aa/image/fce953d0-ad31-4a47-7bcd-7590407c1d24.jpg" width="40"/>
     <a class="text-xl font-semibold tracking-wide select-none" href="#">
      NewsApp
     </a>
    </div>
    <div class="hidden md:flex space-x-8 font-medium">
     <a class="hover:text-blue-600 dark:hover:text-blue-400 transition" href="#">
      Home
     </a>
     <a class="hover:text-blue-600 dark:hover:text-blue-400 transition" href="#kategori">
      Kategori
     </a>
     <a class="hover:text-blue-600 dark:hover:text-blue-400 transition" href="#tentang">
      Tentang
     </a>
    </div>
    <div class="flex items-center space-x-4">
     <button aria-label="Toggle dark mode" class="text-gray-600 dark:text-gray-300 hover:text-blue-600 dark:hover:text-blue-400 transition text-lg focus:outline-none" id="darkModeToggle" title="Toggle dark mode">
      <i class="fas fa-moon">
      </i>
     </button>
     <button aria-label="Toggle menu" class="md:hidden text-gray-600 dark:text-gray-300 hover:text-blue-600 dark:hover:text-blue-400 transition text-2xl focus:outline-none" id="mobileMenuButton">
      <i class="fas fa-bars">
      </i>
     </button>
    </div>
   </nav>
   <div class="md:hidden bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700 hidden" id="mobileMenu">
    <a class="block px-4 py-3 border-b border-gray-200 dark:border-gray-700 hover:bg-gray-100 dark:hover:bg-gray-700 transition" href="#">
     Home
    </a>
    <a class="block px-4 py-3 border-b border-gray-200 dark:border-gray-700 hover:bg-gray-100 dark:hover:bg-gray-700 transition" href="#kategori">
     Kategori
    </a>
    <a class="block px-4 py-3 hover:bg-gray-100 dark:hover:bg-gray-700 transition" href="#tentang">
     Tentang
    </a>
   </div>
  </header>
  <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
   <section aria-label="Pencarian berita" class="mb-8">
    <form class="flex flex-col sm:flex-row gap-3 sm:gap-4 items-center" id="searchForm">
     <input aria-label="Cari berita" class="flex-grow rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 placeholder-gray-400 dark:placeholder-gray-500 px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 transition" id="searchInput" name="search" placeholder="Cari berita..." type="text"/>
     <select aria-label="Pilih kategori berita" class="rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 transition" id="categorySelect">
      <option value="">
       Semua Kategori
      </option>
      <option value="business">
       Bisnis
      </option>
      <option value="technology">
       Teknologi
      </option>
      <option value="sports">
       Olahraga
      </option>
      <option value="health">
       Kesehatan
      </option>
     </select>
     <button class="bg-blue-600 hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600 text-white font-semibold rounded-md px-5 py-2 transition focus:outline-none focus:ring-2 focus:ring-blue-500" type="submit">
      Cari
     </button>
    </form>
   </section>
   <section aria-label="Daftar berita terkini" class="min-h-[300px]" id="newsSection">
    <div aria-busy="true" aria-live="polite" class="flex justify-center items-center py-20" hidden="" id="loadingIndicator">
     <svg aria-hidden="true" class="animate-spin h-10 w-10 text-blue-600 dark:text-blue-400" fill="none" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
      <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4">
      </circle>
      <path class="opacity-75" d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z" fill="currentColor">
      </path>
     </svg>
     <span class="sr-only">
      Memuat berita...
     </span>
    </div>
    <div class="text-center text-red-600 dark:text-red-400 font-semibold py-10 hidden" id="errorMessage" role="alert">
    </div>
    <div class="text-center text-gray-600 dark:text-gray-400 font-semibold py-10 hidden" id="noResultsMessage" role="alert">
     Berita tidak ditemukan.
    </div>
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8" id="newsGrid">
    </div>
   </section>
   <nav aria-label="Navigasi halaman berita" class="flex justify-center items-center space-x-3 mt-12" id="pagination">
    <button aria-disabled="true" class="px-4 py-2 rounded-md bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed transition" disabled="" id="prevPage">
     <i class="fas fa-chevron-left mr-1">
     </i>
     Sebelumnya
    </button>
    <span class="font-semibold text-gray-700 dark:text-gray-300 select-none" id="pageInfo">
    </span>
    <button aria-disabled="true" class="px-4 py-2 rounded-md bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed transition" disabled="" id="nextPage">
     Berikutnya
     <i class="fas fa-chevron-right ml-1">
     </i>
    </button>
   </nav>
  </main>
  <footer class="bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300 text-center py-6 mt-16 select-none" id="tentang">
   <p>
    © 2025 NewsApp. Semua hak cipta dilindungi.
   </p>
  </footer>
  <script>
  (() => {
    const API_KEY = "fef1a00e28d29b01d82108da77ac80b0"; // Ganti ini dengan API Key dari gnews.io
    const PAGE_SIZE = 9;

    const newsGrid = document.getElementById("newsGrid");
    const loadingIndicator = document.getElementById("loadingIndicator");
    const errorMessage = document.getElementById("errorMessage");
    const noResultsMessage = document.getElementById("noResultsMessage");
    const searchForm = document.getElementById("searchForm");
    const searchInput = document.getElementById("searchInput");
    const categorySelect = document.getElementById("categorySelect");
    const prevPageBtn = document.getElementById("prevPage");
    const nextPageBtn = document.getElementById("nextPage");
    const pageInfo = document.getElementById("pageInfo");
    const darkModeToggle = document.getElementById("darkModeToggle");
    const mobileMenuButton = document.getElementById("mobileMenuButton");
    const mobileMenu = document.getElementById("mobileMenu");

    let currentPage = 1;
    let totalResults = 0;
    let currentQuery = "";
    let currentCategory = "";

    function formatDate(dateString) {
      if (!dateString) return "";
      const months = ["Januari", "Februari", "Maret", "April", "Mei", "Juni", "Juli", "Agustus", "September", "Oktober", "November", "Desember"];
      const date = new Date(dateString);
      if (isNaN(date)) return "";
      const day = date.getDate();
      const month = months[date.getMonth()];
      const year = date.getFullYear();
      return `${day} ${month} ${year}`;
    }

    const defaultImage = "https://placehold.co/600x400/png?text=Gambar+Berita+Tidak+Tersedia";

    function clearNews() {
      newsGrid.innerHTML = "";
      errorMessage.hidden = true;
      noResultsMessage.hidden = true;
    }

    function showLoading() {
      loadingIndicator.hidden = false;
      errorMessage.hidden = true;
      noResultsMessage.hidden = true;
      newsGrid.innerHTML = "";
    }

    function hideLoading() {
      loadingIndicator.hidden = true;
    }

    function showError(msg) {
      errorMessage.textContent = msg;
      errorMessage.hidden = false;
      noResultsMessage.hidden = true;
      newsGrid.innerHTML = "";
    }

    function showNoResults() {
      noResultsMessage.hidden = false;
      errorMessage.hidden = true;
      newsGrid.innerHTML = "";
    }

    function renderNews(articles) {
      clearNews();
      if (!articles || articles.length === 0) {
        showNoResults();
        return;
      }

      const fragment = document.createDocumentFragment();

      articles.forEach((article) => {
        const { image, title, publishedAt, description, url, source } = article;

        const card = document.createElement("article");
        card.setAttribute("tabindex", "0");
        card.className = "flex flex-col bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden hover:shadow-lg transition-shadow duration-300 focus:outline-none focus:ring-2 focus:ring-blue-500";

        const imgWrapper = document.createElement("div");
        imgWrapper.className = "w-full aspect-[3/2] overflow-hidden bg-gray-200 dark:bg-gray-700";

        const img = document.createElement("img");
        img.src = image || defaultImage;
        img.alt = title || "Gambar berita";
        img.loading = "lazy";
        img.className = "object-cover w-full h-full";
        imgWrapper.appendChild(img);

        const content = document.createElement("div");
        content.className = "flex flex-col flex-grow p-4";

        const h2 = document.createElement("h2");
        h2.className = "text-lg font-semibold mb-2 line-clamp-2 text-gray-900 dark:text-gray-100";
        h2.textContent = title || "Judul berita tidak tersedia";

        const meta = document.createElement("p");
        meta.className = "text-sm text-gray-500 dark:text-gray-400 mb-3 select-none";
        meta.textContent = formatDate(publishedAt);
        if (source && source.name) {
          meta.textContent += ` • ${source.name}`;
        }

        const desc = document.createElement("p");
        desc.className = "text-gray-700 dark:text-gray-300 flex-grow line-clamp-3 mb-4";
        desc.textContent = description || "Deskripsi berita tidak tersedia.";

        const btn = document.createElement("a");
        btn.href = url || "#";
        btn.target = "_blank";
        btn.rel = "noopener noreferrer";
        btn.className = "inline-block mt-auto self-start bg-blue-600 hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600 text-white font-semibold rounded-md px-4 py-2 transition focus:outline-none focus:ring-2 focus:ring-blue-500";
        btn.textContent = "Baca Selengkapnya";

        content.appendChild(h2);
        content.appendChild(meta);
        content.appendChild(desc);
        content.appendChild(btn);

        card.appendChild(imgWrapper);
        card.appendChild(content);
        fragment.appendChild(card);
      });

      newsGrid.appendChild(fragment);
    }

    function updatePagination() {
      const totalPages = Math.ceil(totalResults / PAGE_SIZE);
      pageInfo.textContent = `Halaman ${currentPage} dari ${totalPages || 1}`;
      prevPageBtn.disabled = currentPage <= 1;
      nextPageBtn.disabled = currentPage >= totalPages;
      prevPageBtn.setAttribute("aria-disabled", prevPageBtn.disabled);
      nextPageBtn.setAttribute("aria-disabled", nextPageBtn.disabled);
    }

    // --- BAGIAN INTI: FETCH DARI GNEWS ---
    async function fetchNews() {
      showLoading();
      clearNews();

      const keyword = [currentQuery, currentCategory].filter(Boolean).join(" ") || "berita";
      const params = new URLSearchParams({
        q: keyword,
        lang: "id",
        max: PAGE_SIZE,
        token: API_KEY,
      });

      try {
        const response = await fetch(`https://gnews.io/api/v4/search?${params.toString()}`);
        if (!response.ok) {
          throw new Error(`Gagal mengambil data: ${response.status} ${response.statusText}`);
        }

        const data = await response.json();
        if (!data.articles) {
          throw new Error(`API error: ${data.message || "Tidak diketahui"}`);
        }

        totalResults = data.totalArticles || data.articles.length;
        renderNews(data.articles);
        updatePagination();
      } catch (error) {
        showError(error.message);
        pageInfo.textContent = "";
      } finally {
        hideLoading();
      }
    }

    searchForm.addEventListener("submit", (e) => {
      e.preventDefault();
      currentQuery = searchInput.value.trim();
      currentCategory = categorySelect.value;
      currentPage = 1;
      fetchNews();
    });

    categorySelect.addEventListener("change", () => {
      currentCategory = categorySelect.value;
      currentPage = 1;
      fetchNews();
    });

    prevPageBtn.addEventListener("click", () => {
      if (currentPage > 1) {
        currentPage--;
        fetchNews();
        window.scrollTo({ top: 0, behavior: "smooth" });
      }
    });

    nextPageBtn.addEventListener("click", () => {
      const totalPages = Math.ceil(totalResults / PAGE_SIZE);
      if (currentPage < totalPages) {
        currentPage++;
        fetchNews();
        window.scrollTo({ top: 0, behavior: "smooth" });
      }
    });

    function setDarkMode(enabled) {
      if (enabled) {
        document.documentElement.classList.add("dark");
        localStorage.setItem("darkMode", "true");
        darkModeToggle.innerHTML = '<i class="fas fa-sun"></i>';
        darkModeToggle.setAttribute("aria-label", "Matikan mode gelap");
        darkModeToggle.title = "Matikan mode gelap";
      } else {
        document.documentElement.classList.remove("dark");
        localStorage.setItem("darkMode", "false");
        darkModeToggle.innerHTML = '<i class="fas fa-moon"></i>';
        darkModeToggle.setAttribute("aria-label", "Nyalakan mode gelap");
        darkModeToggle.title = "Nyalakan mode gelap";
      }
    }

    darkModeToggle.addEventListener("click", () => {
      const isDark = document.documentElement.classList.contains("dark");
      setDarkMode(!isDark);
    });

    (function initDarkMode() {
      const saved = localStorage.getItem("darkMode");
      if (saved === "true") {
        setDarkMode(true);
      } else if (saved === "false") {
        setDarkMode(false);
      } else {
        const prefersDark = window.matchMedia("(prefers-color-scheme: dark)").matches;
        setDarkMode(prefersDark);
      }
    })();

    mobileMenuButton.addEventListener("click", () => {
      if (mobileMenu.classList.contains("hidden")) {
        mobileMenu.classList.remove("hidden");
        mobileMenuButton.setAttribute("aria-expanded", "true");
      } else {
        mobileMenu.classList.add("hidden");
        mobileMenuButton.setAttribute("aria-expanded", "false");
      }
    });

    fetchNews();
  })();
</script>
 </body>
</html>
